# GCP Artifact Registry Terraform module
Terraform module which creates Cloud DNS resources on GCP.

This module will create the following components:
- DNS managed zone with provided zone name and DNS name.
- DNS records name with provided type, ttl, and rrdatas.

## Usage
### Create Artifact Registry
```hcl
module "docker_repository" {
  source  = "github.com/spartan-stratos/terraform-modules//gcp/artifact-registry?ref=v0.1.0"
  
  format        = "DOCKER"
  location      = "us-west1"
  project_id    = "example-project"
  repository_id = "service-image"
  
  docker_config = {
    immutable_tags = true
  }
  
  cleanup_policies = {
    keep_1_month = {
      action = "DELETE"
      condition = {
        older_than_days = "30d"
      }
    }
  }
}
```

## Examples
- [Example](./examples/complete/)

<!-- BEGIN_TF_DOCS -->
## Requirements

| Name                                                                            | Version  |
|---------------------------------------------------------------------------------|----------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform)       | >= 1.9.8 |
| <a name="requirement_google"></a> [google](#requirement\_google)                | \>= 6.12 |
| <a name="requirement_google-beta"></a> [google-beta](#requirement\_google-beta) | \>= 6.12 |

## Providers

| Name                                                                      | Version  |
|---------------------------------------------------------------------------|----------|
| <a name="provider_google"></a> [google](#provider\_google)                | \>= 6.12 |
| <a name="provider_google-beta"></a> [google-beta](#provider\_google-beta) | \>= 6.12 |

## Modules

No modules.

## Resources

| Name                                                                                                                                                                                                                     | Type     |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| [google_artifact_registry_repository.this](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/artifact_registry_repository)                                                                  | resource |
| [google_artifact_registry_vpcsc_config.this](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/artifact_registry_vpcsc_config)                                                              | resource |
| [google_artifact_registry_repository_iam_member.readers](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/artifact_registry_repository_iam#google_artifact_registry_repository_iam_member) | resource |
| [google_artifact_registry_repository_iam_member.writers](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/artifact_registry_repository_iam#google_artifact_registry_repository_iam_member) | resource |

## Inputs

| Name                                                                                                            | Description                                                                                                                                                                                                                                                                                                      | Type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Default               | Required |
|-----------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|:--------:|
| <a name="input_project_id"></a> [project\_id](#input\_project\_id)                                              | The name of the project in which the resource belongs. If it is not provided, the provider project is used.                                                                                                                                                                                                      | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `null`                |    no    |
| <a name="input_repository_id"></a> [repository\_id](#input\_repository\_id)                                     | The artifact repository name.                                                                                                                                                                                                                                                                                    | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | n/a                   |   yes    |
| <a name="input_location"></a> [location](#input\_location)                                                      | The name of the location this repository is located in.                                                                                                                                                                                                                                                          | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | n/a                   |   yes    |
| <a name="input_format"></a> [format](#input\_format)                                                            | The format of packages that are stored in the repository. Possible values are: DOCKER, MAVEN, NPM, PYTHON, APT, YUM, KUBEFLOW, GO, GENERIC.                                                                                                                                                                      | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | n/a                   |   yes    |
| <a name="input_mode"></a> [mode](#input\_mode)                                                                  | The mode configures the repository to serve artifacts from different sources. Default value is STANDARD_REPOSITORY. Possible values are: STANDARD_REPOSITORY, VIRTUAL_REPOSITORY, REMOTE_REPOSITORY.                                                                                                             | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `STANDARD_REPOSITORY` |    no    |
| <a name="input_description"></a> [description](#input\_description)                                             | The user-provided description of the repository.                                                                                                                                                                                                                                                                 | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `null`                |    no    |
| <a name="input_labels"></a> [labels](#input\_labels)                                                            | Labels for the repository.                                                                                                                                                                                                                                                                                       | `map(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `{}`                  |    no    |
| <a name="input_kms_key_name"></a> [kms\_key\_name](#input\_kms\_key\_name)                                      | The Cloud KMS (Key Management Service) resource name of the customer managed encryption key thatâ€™s used to encrypt the contents of the repository. Has the form: projects/my-project/locations/my-region/keyRings/my-kr/cryptoKeys/my-key. This value may not be changed after the repository has been created." | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `null`                |    no    |
| <a name="input_docker_config"></a> [docker\_config](#input\_docker\_config)                                     | Docker repository config contains repository level configuration for the repositories of docker type."                                                                                                                                                                                                           | <pre>object({<br/>  immutable_tags = optional(bool)</br>})</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | `null`                |    no    |
| <a name="input_maven_config"></a> [maven_config](#input\_maven\_config)                                         | Maven repository-specific configuration details.                                                                                                                                                                                                                                                                 | <pre>object({<br/>  allow_snapshot_overwrites = optional(bool)<br/>  version_policy            = optional(string)<br/>})</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `null`                |    no    |
| <a name="input_virtual_repository_config"></a> [virtual_repository_config](#input\_virtual\_repository\_config) | Configuration specific to a virtual repository.                                                                                                                                                                                                                                                                  | <pre>object({<br/>  upstream_policies = optional(list(object({<br/>    id         = string<br/>    repository = string<br/>    priority   = number<br/>  })), null)<br/>})</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | `null`                |    no    |
| <a name="input_remote_repository_config"></a> [remote_repository_config](#input\_remote\_repository\_config)    | Configuration specific to a remote repository.                                                                                                                                                                                                                                                                   | <pre>object({</br>  description = optional(string)</br>  apt_repository = optional(object({</br>    public_repository = optional(object({</br>      repository_base = string</br>      repository_path = string</br>    }), null)</br>  }), null)</br>  docker_repository = optional(object({</br>    public_repository = optional(string, "DOCKER_HUB")</br>  }), null)</br>  maven_repository = optional(object({</br>    public_repository = optional(string, "MAVEN_CENTRAL")</br>  }), null)</br>  npm_repository = optional(object({</br>    public_repository = optional(string, "NPMJS")</br>  }), null)</br>  python_repository = optional(object({</br>    public_repository = optional(string, "PYPI")</br>  }), null)</br>  yum_repository = optional(object({</br>    public_repository = optional(object({</br>      repository_base = string</br>      repository_path = string</br>    }), null)</br>  }), null)</br>})</pre>  | `null`                |    no    |
| <a name="input_cleanup_policy_dry_run"></a> [cleanup_policy_dry_run](#input\_cleanup\_policy\_dry\_run)         | If `true`, prevents the cleanup pipeline from deleting versions in this repository.                                                                                                                                                                                                                              | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `false`               |    no    |
| <a name="input_cleanup_policies"></a> [cleanup_policies](#input\_cleanup\_policies)                             | Cleanup policies for the repository, specifying rules for deleting unused or old artifacts.                                                                                                                                                                                                                      | <pre>map(object({<br>  action=optional(string)<br>  condition=optional(object({<br>    tag_state             = optional(string)<br>    tag_prefixes          = optional(list(string))<br>    version_name_prefixes = optional(list(string))<br>    package_name_prefixes = optional(list(string))<br>    older_than            = optional(string)<br>    newer_than            = optional(string)<br>  }), null), <br>  most_recent_versions=optional(object({<br>    package_name_prefixes = optional(list(string))<br>    keep_count            = optional(number)<br>  }), null)<br>}))</pre>                                                                                                                                                                                                                                                                                                                                               | `{}`                  |    no    |
| <a name="input_enable_vpcsc_policy"></a> [enable_vpcsc_policy](#input\_enable\_vpcsc\_policy)                   | Enable the VPC Service Control policy for the repository.                                                                                                                                                                                                                                                        | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `false`               |    no    |
| <a name="input_vpcsc_policy"></a> [vpcsc_policy](#input\_vpcsc\_policy)                                         | VPC Service Control policy for the repository. Valid values are `ALLOW` or `DENY`.                                                                                                                                                                                                                               | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `ALLOW`               |    no    |
| <a name="input_members"></a> [members](#input\_members)                                                         | Map defining Artifact Registry Reader and Writer roles for users/service accounts. Valid keys are `readers` and `writers`.                                                                                                                                                                                       | `map(list(string))`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | `{}`                  |    no    |

## Outputs

| Name                                                                   | Description                                                                                                              |
|------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| <a name="artifact_id"></a> [artifact\_id](#output\_artifact\_id)       | An identifier for the resource with format `projects/{{project}}/locations/{{location}}/repositories/{{repository_id}}`. |
| <a name="artifact_name"></a> [artifact\_name](#output\_artifact\_name) | The name of the repository created from input repository_id.                                                             |
<!-- END_TF_DOCS -->
